# Ralph Progress Log
Started: Sat Feb 14 11:28:47 CST 2026
---

## Codebase Patterns
- OpenCode enables Kitty keyboard protocol via `useKittyKeyboard: {}` in `app.tsx:171` (flags: disambiguate + alternateKeys)
- OpenTUI's `ParsedKey` has fields: name, ctrl, meta, shift, option, super, hyper, capsLock, numLock, source ("raw" | "kitty"), eventType
- OpenTUI's `KeyBinding` matching uses `getKeyBindingKey()`: `"${name}:${ctrl}:${shift}:${meta}:${super}"` - exact match required
- In standard terminals, Ctrl+J (0x0A) parses to `{ name: "linefeed" }`, NOT `{ name: "j", ctrl: true }` - the linefeed check in parseKeypress happens before the ctrl+letter check
- Default key aliases in OpenTUI: only `enter` → `return` and `esc` → `escape`
- Textarea keybindings flow: config.ts defaults → Keybind.parse() → keybind context → mapTextareaKeybindings() → OpenTUI KeyBinding[]
- Hardcoded fallback bindings in useTextareaKeybindings: `{ name: "return", action: "submit" }` and `{ name: "return", meta: true, action: "newline" }`
- Config-driven bindings are appended AFTER hardcoded ones (last-write-wins in OpenTUI's buildKeyBindingsMap)

---

## 2026-02-14 - US-001
- Diagnosed terminal Shift+Enter support through source code analysis
- Created KEYBINDING-DIAGNOSIS.md documenting all findings
- Files changed:
  - packages/opencode/src/cli/cmd/tui/component/KEYBINDING-DIAGNOSIS.md (new)
- **Learnings for future iterations:**
  - OpenTUI's standard keypress parser handles `\n` (0x0A / Ctrl+J) as `name: "linefeed"` BEFORE reaching the ctrl+letter branch, so `ctrl+j` config binding won't match in non-Kitty terminals
  - OpenTUI's Kitty keyboard parser correctly handles Ctrl+J as `{ name: "j", ctrl: true }` via the CSI u protocol
  - Shift+Enter works correctly in Kitty-protocol terminals but is indistinguishable from Enter in standard terminals
  - Alt+Enter is the most reliable modifier+Enter combo across terminal types (works via `\x1b\r` → `{ name: "return", meta: true }`)
  - The diagnosis was done entirely through source code analysis - no runtime debug logging was needed since OpenTUI's parser source is available in node_modules
---
